<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>reveal.js - The HTML Presentation Framework</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section data-markdown>
					<script type="text/template">
						# Docker
						### Bibek Shrestha
						
						ruby developer @ fromAtoB.com

						11.06.2014 - Munich Rubyshift - Munich Ruby Users Group
						
						[@bibstha](http://twitter.com/bibstha)
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
					  ## Topics

					  1. Docker introduction
					  1. Technology
					  1. General Concepts
					  1. Use cases
					  1. Example: Refactoring bharkhar.com
					  1. Live demo
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						<img src="img/docker-whale-home-logo+.png"/>

						Docker is a platform to **build**, **ship** and **run** your applications.

						Developers, QA, Sys-admins
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						The Challenge

						<img src="img/the-challenge.png">
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						Shipping pre 1960

						<img src="img/cargo-transport-pre-1960.png">
					</script>

				</section>

				<section data-markdown>
					<script type="text/template">
						Shipping Containers

						<img src="img/intermodal-shipping-container.png">
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						Docker provides containers for your application and it&#039;s dependencies.

						<img src="img/shipping-container-for-code.png">
					</script>
				</section>

				<!-- Technology -->
				<section data-markdown>
					<script type="text/template">
						### Technologies

						1. libcontainer or LXC (LinuX Container)
						  * chroot, 
						  * virtualise ram, cpu, disk io, network, etc
						1. cgroups
						  * namespaced isolated grouping of processes
						1. aufs, btrfs, xfs - Union file system
						  * copy on write file system
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						### VMs vs Containers

						<img src="img/containers-vs-vms.png"/>
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						### Layered file system

						<img src="img/docker-filesystems-multilayer.png" />
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						### Docker Concepts

						* Opensource virtualization platform
						* Docker Hub (online repository for managing and sharing containers)
							* Convergence of popular containers
							* Github like collaboration
					</script>
				</section>

				<section>
				  <h3>Inside docker</h3>
					<div style="position: absolute; left: 1%; top: 100px; width: 40%;">
						<img src="img/architecture.svg" style="padding: 5px"/>
					</div>
					<div style="position: absolute; left: 44%; top: 100px; width: 56%;">
					  <ul style="font-size: 26px;">
							<li class="fragment" data-fragment-index="0">Docker images<br/>
							Read only templates. eg: <em>Ubuntu with Apache and MySQL installed</em>, <em>Linux with Redis</em>, etc</li>
							<li class="fragment" data-fragment-index="1">Docker containers
								<ul>
									<li>A running instance of an image.</li>
									<li>Can run multiple containers from same image, completely isolated from eachother.</li>
								</ul>
							</li>
							<li class="fragment" data-fragment-index="2">Docker registry
								<ul>
									<li>Pull and push, online repository for private and public containers.</li>
									<li>Use <a href="https://hub.docker.com">docker hub</a> or install privately.</li>
								</ul>
							</li>
						</ul>
					</div>
				</section>

				<section data-markdown style="font-size: 0.9em; line-height: 1.3em;">
					<script type="text/template">
						### Use cases

						* Ebay Now<br/>
						Docker for continuous integration process. From dev laptop to test and QA. [slide](https://speakerdeck.com/teddziuba/docker-at-ebay)
						* Mailgun<br/>
						Siginificant investment on building docker centric continuous integration. [video](http://youtu.be/CMC3xdAo9RI)
						* Yandex Cocaine<br/>
						PaaS similar to Google Cloud and Heroku. Docker for infrastructure virtualization and app isolation. [blog](http://blog.docker.com/2013/10/yandex-using-docker-for-infrastructure-virtualization-and-app-isolation/)
						* Spotify<br/>
						Replaced ssh-ing to individual nodes and doing app update with Docker. [video](http://youtu.be/pts6F00GFuU)
						
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						### Ecosystem

						* Operating Systems
							* Any distro with linux kernel 3.8+
							* Distros: OS X, Ubuntu, Debian, Fedora, Arch, Crux and most other common distros
							* CoreOS - Build with docker. A new linux distro rearchitectured to provide common features to run modern infrastructure stack.
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						### Ecosystem

						* Public IaaS
							* Cloud: DigitalOcean, Linode, Rackspace, IBM Softlayer, Amazon EC2, etc.
						* PaaS
							* Build your own: Dokku, Flynn, Deis
							* Public Paas: Yandex Cocaine, Amazon Elasticbeanstalk, Google Cloud Platform, etc.
						
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						### Refactoring Bharkhar.com
						
						Newspaper websites in Nepal have horrible interfaces. 

						Crawls and combines multiple images to a single PDF everyday.

						Give the feeling of a real news paper.
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						### Initial Stack
						
						* PHP based Crawler.
						* CronJob runs a php script every day.
						* Web frontend in Django (Apache / Passenger / wsgi)
						* Git pull, git push, restart apache
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						### Issues
						
						* Cron failures caused large number of mails in local mailbox. Took up lots of disk space.
						* Works in local, does not work in server.
						* Migrated from Linode to SoftLayer (remember and repeat all setup steps)			
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
					### New Stack Iteration 1

					* Sidekiq + Sidetiq worker (no more cron)
					* Ruby based crawler (Typhoeus, Nokogiri)
					* Sinatra + Slim Templates + Thin

					* Dockerfile
						* Environment Setup
						* bundle install
					* Supervisord runs
						* sshd
						* redis
						* Sinatra
						* sidekiq
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
					### New Stack Iteration 1

					```bash
					➜  ~  cat /etc/nginx/sites-enabled/bharkhar.com
					server {
						listen 80;
						server_name bharkhar.com;
						location / {
							proxy_pass http://localhost:4567;
						}
					}
					```

					Run dockerized application

					```bash
					➜  ~  docker run -d --name bharkharapp \
					  -p 127.0.0.1:4567:4567 -p 127.0.0.1:49122:22 \
					  bharkharapp
					```
					</script>
				</section>

				<section data-markdown>
					<script type="text/template">
						### Issues

						* Application upgrade will bring both web frontend and crawler down.
						* Big Gemfile, longer deploy times
					</script>
				</section>


				<section>
					<h3>New Stack Iteration 2</h3>
					<ul style="font-size: 24px; position: absolute; left: 1%; top: 100px; width: 48%;">
						<li>A ruby 2.1.1 image <a href="https://github.com/bibstha/docker-ruby-2.1">bibstha/docker-ruby-2.1</a></li>
						<li>Use existing docker image for redis.</li>
						<li>Separate projects, individual Dockerfile for <strong>Sinatra app</strong> and <strong>Sidekiq app</strong>.</li>
							<li>Uses ruby 2.1.1 image (no compiling ruby each time)</li>
						<li>Remove Supervisord</li>
					</ul>

					<ul style="font-size: 24px; position: absolute; left: 52%; top: 100px; width: 48%;" class="fragment" data-fragment-index="0">
						<li>Faster deploy</li>
						<li>Docker takes care of the processes</li>
						<li>Frontend keeps on working even when crawler container is removed</li>
					</ul>

				</section>

				<section>
					<h3>What next?</h3>
					<ul>
						<li>Unified logging,</li>
						<li>Supervisord on host machine<br/>
						(start docker processes on restart)</li>
						<li><em>Deis</em> or <em>Dokku</em> for <br/>
						heroku style app deployment</li>
					</ul>
				</section>

				<section>
				  <h3>Live demo</h3>
				</section>

				<section>
					<h2>Links</h2>
					<ul>
						<li><a href="http://www.docker.com">Docker Home</a></li>
						<li><a href="http://docs.docker.com/">Docker Docs and Install Instruction</a></li>
						<li><a href="https://github.com/bibstha/bharkhar-frontend">Bharkhar Frontend</a></li>
						<li><a href="https://github.com/bibstha/bharkhar-downloader">Bharkhar Sidekiq</a></li>
						<li><a href="http://twitter.com/bibstha">Follow me on Twitter</a></li>
					</ul>
				</section>

				<section>
					<h1>THE END</h1>
					<h3>BY Bibek Shrestha</h3>
					<h4>http://www.bibekshrestha.com</h4>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				// theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				// transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none
				theme: 'beige',
				transition: 'linear',

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
